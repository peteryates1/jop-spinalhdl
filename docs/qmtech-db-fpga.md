# QMTECH DB_FPGA Daughter Board

## Overview

Universal daughter board for QMTECH FPGA core boards. Connects via dual 32×2 pin
headers (J2, J3) at 0.1" pitch. Confirmed compatible with:

- **QMTECH EP4CGX150** (Cyclone IV GX) — primary JOP platform
- **QMTECH EP4CE15** (Cyclone IV E) — has example projects for all peripherals
- **QMTECH XC7A75T/100T/200T** (Artix-7) — potential JOP DDR3 + DB_FPGA platform

GitHub: <https://github.com/ChinaQMTECH/DB_FPGA>

Reference files: `/srv/git/qmtech/DB_FPGA/`

Schematic: `QMTECH_DB_For_FPGA_V04.pdf` (V04, without RP2040)
Enhanced version: `/srv/git/qmtech/DB_FPGA_with_RP2040/DB_FPGA_V5-20221108.pdf` (V05, with RP2040)

## Peripherals

| Peripheral | Component | Interface | Status in JOP |
|------------|-----------|-----------|--------------|
| **Ethernet** | RTL8211EG PHY | GMII 8-bit (1 Gbps) | Working — `BmbEth` + `BmbMdio` |
| **UART** | CP2102N USB-to-UART | TX/RX + USB | Working — `BmbUart` (1 Mbaud) |
| **VGA** | Direct RGB (5-6-5) | 15-pin D-sub | Working — `BmbVgaText` (80×30) |
| **SD card** | microSD slot | Native 4-bit / SPI | Working — `BmbSdNative` / `BmbSdSpi` |
| **7-segment** | 3-digit (2352B) | Multiplexed 8+3 lines | Not used by JOP |
| **PMOD** | J10, J11 connectors | 12-pin GPIO each | Available for expansion |

## Pin Assignments (EP4CGX150)

Pin assignments are board-specific because the connector-to-FPGA mapping differs
per core board. These are the EP4CGX150 assignments from the JOP project
(`fpga/qmtech-ep4cgx150-sdram/jop_dbfpga.qsf`).

### UART (CP2102N)

| Signal | Pin | Direction |
|--------|-----|-----------|
| `ser_txd` | PIN_AD20 | FPGA → CP2102N |
| `ser_rxd` | PIN_AE21 | CP2102N → FPGA |

### Ethernet (RTL8211EG, GMII)

**Management:**

| Signal | Pin |
|--------|-----|
| `e_mdc` | PIN_A20 |
| `e_mdio` | PIN_A21 |
| `e_resetn` | PIN_A15 |

**Receive path:**

| Signal | Pin |
|--------|-----|
| `e_rxc` | PIN_B10 |
| `e_rxdv` | PIN_A8 |
| `e_rxd[0]` | PIN_A9 |
| `e_rxd[1]` | PIN_B9 |
| `e_rxd[2]` | PIN_C10 |
| `e_rxd[3]` | PIN_A10 |
| `e_rxd[4]` | PIN_A11 |
| `e_rxd[5]` | PIN_B11 |
| `e_rxd[6]` | PIN_A12 |
| `e_rxd[7]` | PIN_A13 |

**Transmit path:**

| Signal | Pin |
|--------|-----|
| `e_gtxc` | PIN_C13 |
| `e_txen` | PIN_C14 |
| `e_txer` | PIN_A19 |
| `e_txd[0]` | PIN_C15 |
| `e_txd[1]` | PIN_B15 |
| `e_txd[2]` | PIN_A16 |
| `e_txd[3]` | PIN_A17 |
| `e_txd[4]` | PIN_C16 |
| `e_txd[5]` | PIN_B18 |
| `e_txd[6]` | PIN_C17 |
| `e_txd[7]` | PIN_A18 |

GMII TX requires a 125 MHz clock on `e_gtxc` (generated by FPGA PLL).
RX clock (`e_rxc`) is source-synchronous from the PHY at 125 MHz.
See [DB_FPGA Ethernet](db-fpga-ethernet.md) for timing constraints and PHY config.

### VGA (RGB 5-6-5)

| Signal | Pin |
|--------|-----|
| `vga_hs` | PIN_A6 |
| `vga_vs` | PIN_A7 |
| `vga_r[4:0]` | PIN_D1, PIN_B1, PIN_E2, PIN_C1, PIN_E1 |
| `vga_g[5:0]` | PIN_C5, PIN_A4, PIN_A3, PIN_C4, PIN_A2, PIN_B2 |
| `vga_b[4:0]` | PIN_B6, PIN_B7, PIN_A5, PIN_B5, PIN_B4 |

Pixel clock (25 MHz for 640×480@60Hz) from PLL c3.
See [DB_FPGA VGA Text](db-fpga-vga-text.md) for register map and Java API.

### SD Card (Native 4-bit / SPI)

| Signal | Pin | Native mode | SPI mode |
|--------|-----|-------------|----------|
| `sd_clk` | PIN_B21 | SD_CLK | SPI_CLK |
| `sd_cmd` | PIN_A22 | CMD line | MOSI |
| `sd_dat_0` | PIN_A23 | DAT0 | MISO |
| `sd_dat_1` | PIN_B23 | DAT1 | — |
| `sd_dat_2` | PIN_B19 | DAT2 | — |
| `sd_dat_3` | PIN_C19 | DAT3/CS | CS |
| `sd_cd` | PIN_B22 | Card detect | Card detect |

See [DB_FPGA SD Card](db-fpga-sd-card.md) for native mode details.

## Pin Assignments (EP4CE15)

From `/srv/git/qmtech/CYCLONE_IV_EP4CE15/Software/` example projects.
Different FPGA package → different pin numbers for the same connector positions.

### UART

| Signal | Pin |
|--------|-----|
| RXD | PIN_J2 |
| TXD | PIN_J1 |

### Ethernet (RTL8211EG/F)

| Signal | Pin |
|--------|-----|
| MDC | PIN_AB17 |
| MDIO | PIN_AA17 |
| RXCLK | PIN_M22 |
| RXDV | PIN_K21 |
| RXD[7:0] | PIN_P22..PIN_K22 |
| GTXC | PIN_U22 |
| TXEN | PIN_V21 |
| TXD[7:0] | PIN_AB18..PIN_V22 |

### SD Card (SPI mode)

| Signal | Pin |
|--------|-----|
| CLK | PIN_AA15 |
| CS | PIN_AA16 |
| MOSI (CMD) | PIN_AB15 |
| MISO (DAT0) | PIN_AB14 |

## Example Projects

Complete working examples in `/srv/git/qmtech/CYCLONE_IV_EP4CE15/Software/`:

| Project | Peripheral | Description |
|---------|-----------|-------------|
| Project05_CP2102_UART_V2 | UART | Echo test, 9600 baud |
| Project06_7SEG_LED | 7-segment | 3-digit multiplexed display |
| Project07_MicroSD | SD card | SPI mode read/write |
| Project08_VGA | VGA | 1024×768@60Hz, 16-bit color, test patterns |
| Project09_GMII_Ethernet | Ethernet | GMII + UDP/IP stack |

## Power

- 3.3V digital (from core board via headers)
- 1.0V + 3.3V analog for Ethernet PHY
- 100 nF decoupling on power pins, 4.7 µF bulk
- 4.7 kΩ pull-ups on MDIO
- 330 Ω current limiting on LEDs
